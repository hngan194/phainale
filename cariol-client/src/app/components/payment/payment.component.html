<div class="checkout-container">
  <div class="checkout-header">
    <div class="progress-steps">
      <div class="step completed">
        <div class="step-circle">1</div>
        <span>Đăng nhập</span>
      </div>
      <div class="step-line"></div>
      <div class="step completed">
        <div class="step-circle">2</div>
        <span>Thông tin</span>
      </div>
      <div class="step-line"></div>
      <div class="step active">
        <div class="step-circle">3</div>
        <span>Thanh toán</span>
      </div>
    </div>
  </div>

  <div class="checkout-content">
    <div class="payment-info">
      <div class="section">
        <h3 class="section-title">Thông tin vận chuyển</h3>
        <div class="shipping-option">
          <label class="radio-container">
            <input type="checkbox" name="shipping" [(ngModel)]="expressShipping" (change)="updateShippingFee()">
            <span class="radio-checkmark"></span>
            <span class="option-text">Vận chuyển trong 1-2 ngày (trừ CN)</span>
            <span class="option-price">20,000</span>
          </label>
        </div>
      </div>


      <div class="section">
        <h3 class="section-title">Phương thức thanh toán</h3>
        <div class="payment-option">
          <label class="radio-container">
            <input type="radio" name="paymentMethod" [(ngModel)]="paymentMethod" value="COD" checked>
            <span class="radio-checkmark"></span>
            <span class="option-text">Thanh toán tiền mặt khi nhận hàng (COD)</span>
          </label>
        </div>
        
        <div class="payment-option">
          <label class="radio-container">
            <input type="radio" name="paymentMethod" [(ngModel)]="paymentMethod" value="BankTransfer">
            <span class="radio-checkmark"></span>
            <span class="option-text">Chuyển khoản ngân hàng</span>
          </label>
        </div>
      </div>

      <div class="action-buttons">
        <button class="back-btn" (click)="goToCart()">Giỏ hàng</button>
        <button class="complete-btn" (click)="completeOrder()">HOÀN TẤT</button>
      </div>
    </div>

    <div class="product-summary">
      <div class="product-item">
        <div class="product-image">
          <img [src]="product.image" alt="{{ product.name }}">
        </div>
        <div class="product-details">
          <div class="product-name">{{ product.name }}</div>
          <div class="product-color"><strong>Màu sắc:</strong> {{ selectedColor }}</div>
          <div class="product-quantity"><strong>Số lượng:</strong> {{ quantity }}</div>
        </div>
        <div class="product-price">{{ product.price | currency:'VND' }}</div>
      </div>

      <div class="coupon-section">
        <div class="coupon-input">
          <!-- <input type="text" [(ngModel)]="discountCode" name="discountCode" placeholder="Mã code">
          <button class="btn-apply">Áp dụng</button> -->
          <!-- <div class="price-row"> -->
          <span class="btn-apply" >Mã giảm giá</span>
          <span>{{ discountCode || '—' }}</span>
          <!-- </div> -->
        </div>
      </div>

      <div class="order-totals">
        <div class="total-row">
          <span>Tạm tính</span>
          <span class="price">{{ total | currency:'VND' }}</span>
        </div>
        <div class="total-row">
          <span>Phí vận chuyển</span>
          <span class="price">{{ shippingFee | currency:'VND' }}</span>
        </div>
        <div class="total-row">
          <span>Giảm giá</span>
          <span class="price">{{ discountAmount | currency:'VND' }}</span>
        </div>
        <div class="total-row grand-total">
          <span>Tổng tiền</span>
          <span class="price">{{ totalPayment  | currency:'VND' }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Popup xác nhận đặt hàng thành công -->
<div class="popup-overlay" *ngIf="orderPopupVisible">
  <div class="popup">
    <h2>Đặt hàng thành công!</h2>
    <p>Cảm ơn bạn đã mua hàng. Đơn hàng của bạn đang được xử lý.</p>
    <button (click)="closePopup()">Đóng</button>
  </div>
</div>